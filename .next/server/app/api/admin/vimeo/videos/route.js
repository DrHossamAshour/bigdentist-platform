"use strict";(()=>{var e={};e.id=3670,e.ids=[3670],e.modules={53524:e=>{e.exports=require("@prisma/client")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},94057:(e,t,i)=>{i.r(t),i.d(t,{headerHooks:()=>f,originalPathname:()=>g,patchFetch:()=>V,requestAsyncStorage:()=>c,routeModule:()=>u,serverHooks:()=>v,staticGenerationAsyncStorage:()=>p,staticGenerationBailout:()=>h});var r={};i.r(r),i.d(r,{GET:()=>m});var o=i(95419),a=i(69108),s=i(99678),d=i(78070),n=i(3214),l=i(7042);async function m(e){try{let e=await n._.course.findMany({where:{videoUrl:{not:null}},select:{id:!0,title:!0,videoUrl:!0,instructor:{select:{firstName:!0,lastName:!0}}}}),t=[],i=new Set;for(let r of e)if(r.videoUrl&&l.b.isValidVimeoUrl(r.videoUrl)){let o=l.b.extractVideoId(r.videoUrl);if(o&&!i.has(o)){i.add(o);let a=await l.b.getVideoInfo(o);a?t.push({id:o,title:a.title,description:a.description,duration:a.duration,durationFormatted:l.b.formatDuration(a.duration),thumbnail:l.b.getThumbnailUrl(o,"medium"),embedUrl:l.b.getEmbedUrl(o),privacy:a.privacy.view,stats:{plays:a.stats.plays,likes:a.stats.likes},createdTime:a.created_time,modifiedTime:a.modified_time,usage:{type:"course",items:e.filter(e=>e.videoUrl===r.videoUrl).map(e=>({id:e.id,title:e.title,instructor:`${e.instructor.firstName} ${e.instructor.lastName}`}))}}):t.push({id:o,title:"Unknown Video",description:"Video metadata unavailable",duration:0,durationFormatted:"0:00",thumbnail:l.b.getThumbnailUrl(o,"medium"),embedUrl:l.b.getEmbedUrl(o),privacy:"unknown",stats:{plays:0,likes:0},createdTime:null,modifiedTime:null,usage:{type:"course",items:e.filter(e=>e.videoUrl===r.videoUrl).map(e=>({id:e.id,title:e.title,instructor:`${e.instructor.firstName} ${e.instructor.lastName}`}))},error:"Could not fetch video metadata"})}else if(o){let e=t.find(e=>e.id===o);e&&e.usage.items.push({id:r.id,title:r.title,instructor:`${r.instructor.firstName} ${r.instructor.lastName}`})}}return t.sort((e,t)=>e.modifiedTime?t.modifiedTime?new Date(t.modifiedTime).getTime()-new Date(e.modifiedTime).getTime():-1:1),d.Z.json({videos:t,total:t.length,summary:{totalVideos:t.length,totalDuration:t.reduce((e,t)=>e+t.duration,0),totalPlays:t.reduce((e,t)=>e+t.stats.plays,0),totalLikes:t.reduce((e,t)=>e+t.stats.likes,0)}})}catch(e){return console.error("Error fetching Vimeo videos:",e),d.Z.json({error:"Failed to fetch Vimeo videos"},{status:500})}}let u=new o.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/admin/vimeo/videos/route",pathname:"/api/admin/vimeo/videos",filename:"route",bundlePath:"app/api/admin/vimeo/videos/route"},resolvedPagePath:"E:\\BigDentist Website\\app\\api\\admin\\vimeo\\videos\\route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:c,staticGenerationAsyncStorage:p,serverHooks:v,headerHooks:f,staticGenerationBailout:h}=u,g="/api/admin/vimeo/videos/route";function V(){return(0,s.patchFetch)({serverHooks:v,staticGenerationAsyncStorage:p})}},3214:(e,t,i)=>{i.d(t,{_:()=>o});var r=i(53524);let o=globalThis.prisma??new r.PrismaClient},7042:(e,t,i)=>{i.d(t,{b:()=>o});class r{constructor(){this.accessToken=process.env.VIMEO_ACCESS_TOKEN||""}extractVideoId(e){for(let t of[/vimeo\.com\/(\d+)/,/vimeo\.com\/video\/(\d+)/,/player\.vimeo\.com\/video\/(\d+)/]){let i=e.match(t);if(i)return i[1]}return null}isValidVimeoUrl(e){return null!==this.extractVideoId(e)}async getVideoInfo(e){if(!this.accessToken)return console.warn("Vimeo access token not configured"),null;try{let t=await fetch(`https://api.vimeo.com/videos/${e}`,{headers:{Authorization:`Bearer ${this.accessToken}`,"Content-Type":"application/json"}});if(!t.ok){if(404===t.status)throw Error("Video not found or is private");throw Error(`Vimeo API error: ${t.status}`)}return await t.json()}catch(e){return console.error("Error fetching Vimeo video info:",e),null}}async validateVideoUrl(e){if(!this.isValidVimeoUrl(e))return{isValid:!1,error:"Invalid Vimeo URL format"};let t=this.extractVideoId(e);if(!t)return{isValid:!1,error:"Could not extract video ID from URL"};let i=await this.getVideoInfo(t);return i?"nobody"===i.privacy.view?{isValid:!1,error:"Video is private and cannot be embedded"}:{isValid:!0,video:i}:{isValid:!1,error:"Video not found or is private"}}getEmbedUrl(e,t={}){let i=new URLSearchParams;t.autoplay&&i.append("autoplay","1"),t.muted&&i.append("muted","1"),!1!==t.controls&&i.append("controls","1"),!1!==t.responsive&&i.append("responsive","1");let r=i.toString();return`https://player.vimeo.com/video/${e}${r?`?${r}`:""}`}formatDuration(e){let t=Math.floor(e/3600),i=Math.floor(e%3600/60),r=e%60;return t>0?`${t}:${i.toString().padStart(2,"0")}:${r.toString().padStart(2,"0")}`:`${i}:${r.toString().padStart(2,"0")}`}getThumbnailUrl(e,t="medium"){return`https://vumbnail.com/${e}_${({small:"640x360",medium:"1280x720",large:"1920x1080"})[t]}.jpg`}}let o=new r}};var t=require("../../../../../webpack-runtime.js");t.C(e);var i=e=>t(t.s=e),r=t.X(0,[1638,6206],()=>i(94057));module.exports=r})();