"use strict";(()=>{var e={};e.id=2475,e.ids=[2475],e.modules={53524:e=>{e.exports=require("@prisma/client")},98432:e=>{e.exports=require("bcryptjs")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},12781:e=>{e.exports=require("stream")},73837:e=>{e.exports=require("util")},15879:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>m,originalPathname:()=>g,patchFetch:()=>w,requestAsyncStorage:()=>f,routeModule:()=>d,serverHooks:()=>v,staticGenerationAsyncStorage:()=>h,staticGenerationBailout:()=>j});var o={};t.r(o),t.d(o,{GET:()=>c,POST:()=>p});var n=t(95419),s=t(69108),a=t(99678),u=t(78070),i=t(3214),l=t(3205);async function c(e){try{let r=e.cookies.get("auth-token")?.value;if(!r)return u.Z.json({error:"Authentication required"},{status:401});let t=(0,l.WX)(r);if(!t)return u.Z.json({error:"Invalid token"},{status:401});if("ADMIN"!==t.role&&"SUPER_ADMIN"!==t.role)return u.Z.json({error:"Unauthorized"},{status:403});let o=await i._.coupon.findMany({orderBy:{createdAt:"desc"}});return u.Z.json(o)}catch(e){return console.error("Error fetching coupons:",e),u.Z.json({error:"Internal server error"},{status:500})}}async function p(e){try{let r=e.cookies.get("auth-token")?.value;if(!r)return u.Z.json({error:"Authentication required"},{status:401});let t=(0,l.WX)(r);if(!t)return u.Z.json({error:"Invalid token"},{status:401});if("ADMIN"!==t.role&&"SUPER_ADMIN"!==t.role)return u.Z.json({error:"Unauthorized"},{status:403});let{code:o,description:n,discountType:s,discountValue:a,minAmount:c,maxDiscount:p,usageLimit:d,validUntil:f,appliesToAllCourses:h,allowedCourseIds:v,canStackWithOtherCoupons:m}=await e.json();if(!o||!s||!a)return u.Z.json({error:"Missing required fields"},{status:400});if(await i._.coupon.findUnique({where:{code:o.toUpperCase()}}))return u.Z.json({error:"Coupon code already exists"},{status:400});let j=await i._.coupon.create({data:{code:o.toUpperCase(),description:n,discountType:s,discountValue:parseFloat(a),minAmount:c?parseFloat(c):null,maxDiscount:p?parseFloat(p):null,usageLimit:d?parseInt(d):null,validUntil:f?new Date(f):null,appliesToAllCourses:void 0===h||h,allowedCourseIds:v||null,canStackWithOtherCoupons:void 0!==m&&m}});return u.Z.json(j,{status:201})}catch(e){return console.error("Error creating coupon:",e),u.Z.json({error:"Internal server error"},{status:500})}}let d=new n.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/coupons/route",pathname:"/api/coupons",filename:"route",bundlePath:"app/api/coupons/route"},resolvedPagePath:"E:\\BigDentist Website\\app\\api\\coupons\\route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:f,staticGenerationAsyncStorage:h,serverHooks:v,headerHooks:m,staticGenerationBailout:j}=d,g="/api/coupons/route";function w(){return(0,a.patchFetch)({serverHooks:v,staticGenerationAsyncStorage:h})}},3205:(e,r,t)=>{t.d(r,{RA:()=>l,So:()=>p,WX:()=>c});var o=t(98432),n=t.n(o),s=t(46082),a=t.n(s),u=t(3214);let i=async(e,r)=>await n().compare(e,r),l=e=>a().sign(e,process.env.JWT_SECRET||"fallback-secret",{expiresIn:"7d"}),c=e=>{try{return a().verify(e,process.env.JWT_SECRET||"fallback-secret")}catch(e){return null}},p=async(e,r)=>{let t=await u._.user.findUnique({where:{email:e}});return t&&await i(r,t.password)?t:null}},3214:(e,r,t)=>{t.d(r,{_:()=>n});var o=t(53524);let n=globalThis.prisma??new o.PrismaClient}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[1638,6206,6082],()=>t(15879));module.exports=o})();