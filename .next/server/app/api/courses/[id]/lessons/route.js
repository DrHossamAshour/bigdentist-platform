"use strict";(()=>{var e={};e.id=5080,e.ids=[5080],e.modules={53524:e=>{e.exports=require("@prisma/client")},98432:e=>{e.exports=require("bcryptjs")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},12781:e=>{e.exports=require("stream")},73837:e=>{e.exports=require("util")},89359:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>w,originalPathname:()=>y,patchFetch:()=>g,requestAsyncStorage:()=>I,routeModule:()=>h,serverHooks:()=>v,staticGenerationAsyncStorage:()=>j,staticGenerationBailout:()=>Z});var s={};t.r(s),t.d(s,{DELETE:()=>f,GET:()=>d,POST:()=>l,PUT:()=>p});var o=t(95419),n=t(69108),i=t(99678),a=t(78070),u=t(3214),c=t(3205);async function d(e,{params:r}){try{let e=r.id,t=await u._.lesson.findMany({where:{topic:{courseId:e}},include:{topic:!0},orderBy:[{topic:{order:"asc"}},{order:"asc"}]});return a.Z.json(t)}catch(e){return console.error("Error fetching lessons:",e),a.Z.json({error:"Internal server error"},{status:500})}}async function l(e,{params:r}){try{let t=e.cookies.get("auth-token")?.value;if(!t)return a.Z.json({error:"Authentication required"},{status:401});let s=(0,c.WX)(t);if(!s)return a.Z.json({error:"Invalid token"},{status:401});r.id;let o=await e.json(),n=await u._.topic.findUnique({where:{id:o.topicId},include:{course:{select:{instructorId:!0}}}});if(!n)return a.Z.json({error:"Topic not found"},{status:404});if(n.course.instructorId!==s.userId&&"ADMIN"!==s.role&&"SUPER_ADMIN"!==s.role)return a.Z.json({error:"Unauthorized"},{status:403});let i=await u._.lesson.findFirst({where:{topicId:o.topicId},orderBy:{order:"desc"},select:{order:!0}}),d=(i?.order||0)+1,l=await u._.lesson.create({data:{title:o.title,description:o.description,content:o.content||"",videoUrl:o.videoUrl,duration:parseInt(o.duration)||0,order:d,topicId:o.topicId},include:{topic:!0}});return a.Z.json(l,{status:201})}catch(e){return console.error("Error creating lesson:",e),a.Z.json({error:"Internal server error"},{status:500})}}async function p(e,{params:r}){try{let t=e.cookies.get("auth-token")?.value;if(!t)return a.Z.json({error:"Authentication required"},{status:401});let s=(0,c.WX)(t);if(!s)return a.Z.json({error:"Invalid token"},{status:401});r.id;let o=e.nextUrl.searchParams.get("lessonId"),n=await e.json();if(!o)return a.Z.json({error:"Lesson ID required"},{status:400});let i=await u._.lesson.findUnique({where:{id:o},include:{topic:{include:{course:{select:{instructorId:!0}}}}}});if(!i)return a.Z.json({error:"Lesson not found"},{status:404});if(i.topic.course.instructorId!==s.userId&&"ADMIN"!==s.role&&"SUPER_ADMIN"!==s.role)return a.Z.json({error:"Unauthorized"},{status:403});let d=await u._.lesson.update({where:{id:o},data:{title:n.title,description:n.description,content:n.content,videoUrl:n.videoUrl,duration:parseInt(n.duration)||0},include:{topic:!0}});return a.Z.json(d)}catch(e){return console.error("Error updating lesson:",e),a.Z.json({error:"Internal server error"},{status:500})}}async function f(e,{params:r}){try{let t=e.cookies.get("auth-token")?.value;if(!t)return a.Z.json({error:"Authentication required"},{status:401});let s=(0,c.WX)(t);if(!s)return a.Z.json({error:"Invalid token"},{status:401});r.id;let o=e.nextUrl.searchParams.get("lessonId");if(!o)return a.Z.json({error:"Lesson ID required"},{status:400});let n=await u._.lesson.findUnique({where:{id:o},include:{topic:{include:{course:{select:{instructorId:!0}}}}}});if(!n)return a.Z.json({error:"Lesson not found"},{status:404});if(n.topic.course.instructorId!==s.userId&&"ADMIN"!==s.role&&"SUPER_ADMIN"!==s.role)return a.Z.json({error:"Unauthorized"},{status:403});return await u._.lesson.delete({where:{id:o}}),a.Z.json({message:"Lesson deleted successfully"})}catch(e){return console.error("Error deleting lesson:",e),a.Z.json({error:"Internal server error"},{status:500})}}let h=new o.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/courses/[id]/lessons/route",pathname:"/api/courses/[id]/lessons",filename:"route",bundlePath:"app/api/courses/[id]/lessons/route"},resolvedPagePath:"E:\\BigDentist Website\\app\\api\\courses\\[id]\\lessons\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:I,staticGenerationAsyncStorage:j,serverHooks:v,headerHooks:w,staticGenerationBailout:Z}=h,y="/api/courses/[id]/lessons/route";function g(){return(0,i.patchFetch)({serverHooks:v,staticGenerationAsyncStorage:j})}},3205:(e,r,t)=>{t.d(r,{RA:()=>c,So:()=>l,WX:()=>d});var s=t(98432),o=t.n(s),n=t(46082),i=t.n(n),a=t(3214);let u=async(e,r)=>await o().compare(e,r),c=e=>i().sign(e,process.env.JWT_SECRET||"fallback-secret",{expiresIn:"7d"}),d=e=>{try{return i().verify(e,process.env.JWT_SECRET||"fallback-secret")}catch(e){return null}},l=async(e,r)=>{let t=await a._.user.findUnique({where:{email:e}});return t&&await u(r,t.password)?t:null}},3214:(e,r,t)=>{t.d(r,{_:()=>o});var s=t(53524);let o=globalThis.prisma??new s.PrismaClient}};var r=require("../../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[1638,6206,6082],()=>t(89359));module.exports=s})();