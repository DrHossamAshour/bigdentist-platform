"use strict";(()=>{var r={};r.id=4404,r.ids=[4404],r.modules={53524:r=>{r.exports=require("@prisma/client")},98432:r=>{r.exports=require("bcryptjs")},30517:r=>{r.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14300:r=>{r.exports=require("buffer")},6113:r=>{r.exports=require("crypto")},12781:r=>{r.exports=require("stream")},73837:r=>{r.exports=require("util")},82292:(r,e,t)=>{t.r(e),t.d(e,{headerHooks:()=>v,originalPathname:()=>Z,patchFetch:()=>g,requestAsyncStorage:()=>j,routeModule:()=>h,serverHooks:()=>w,staticGenerationAsyncStorage:()=>I,staticGenerationBailout:()=>y});var o={};t.r(o),t.d(o,{DELETE:()=>f,GET:()=>d,POST:()=>l,PUT:()=>p});var s=t(95419),i=t(69108),n=t(99678),a=t(78070),u=t(3214),c=t(3205);async function d(r,{params:e}){try{let r=e.id,t=await u._.topic.findMany({where:{courseId:r},include:{lessons:{orderBy:{order:"asc"}}},orderBy:{order:"asc"}});return a.Z.json(t)}catch(r){return console.error("Error fetching topics:",r),a.Z.json({error:"Internal server error"},{status:500})}}async function l(r,{params:e}){try{let t=r.cookies.get("auth-token")?.value;if(!t)return a.Z.json({error:"Authentication required"},{status:401});let o=(0,c.WX)(t);if(!o)return a.Z.json({error:"Invalid token"},{status:401});let s=e.id,i=await r.json(),n=await u._.course.findUnique({where:{id:s},select:{instructorId:!0}});if(!n)return a.Z.json({error:"Course not found"},{status:404});if(n.instructorId!==o.userId&&"ADMIN"!==o.role&&"SUPER_ADMIN"!==o.role)return a.Z.json({error:"Unauthorized"},{status:403});let d=await u._.topic.findFirst({where:{courseId:s},orderBy:{order:"desc"},select:{order:!0}}),l=(d?.order||0)+1,p=await u._.topic.create({data:{title:i.title,description:i.description,order:l,courseId:s},include:{lessons:{orderBy:{order:"asc"}}}});return a.Z.json(p,{status:201})}catch(r){return console.error("Error creating topic:",r),a.Z.json({error:"Internal server error"},{status:500})}}async function p(r,{params:e}){try{let t=r.cookies.get("auth-token")?.value;if(!t)return a.Z.json({error:"Authentication required"},{status:401});let o=(0,c.WX)(t);if(!o)return a.Z.json({error:"Invalid token"},{status:401});e.id;let s=r.nextUrl.searchParams.get("topicId"),i=await r.json();if(!s)return a.Z.json({error:"Topic ID required"},{status:400});let n=await u._.topic.findUnique({where:{id:s},include:{course:{select:{instructorId:!0}}}});if(!n)return a.Z.json({error:"Topic not found"},{status:404});if(n.course.instructorId!==o.userId&&"ADMIN"!==o.role&&"SUPER_ADMIN"!==o.role)return a.Z.json({error:"Unauthorized"},{status:403});let d=await u._.topic.update({where:{id:s},data:{title:i.title,description:i.description},include:{lessons:{orderBy:{order:"asc"}}}});return a.Z.json(d)}catch(r){return console.error("Error updating topic:",r),a.Z.json({error:"Internal server error"},{status:500})}}async function f(r,{params:e}){try{let t=r.cookies.get("auth-token")?.value;if(!t)return a.Z.json({error:"Authentication required"},{status:401});let o=(0,c.WX)(t);if(!o)return a.Z.json({error:"Invalid token"},{status:401});e.id;let s=r.nextUrl.searchParams.get("topicId");if(!s)return a.Z.json({error:"Topic ID required"},{status:400});let i=await u._.topic.findUnique({where:{id:s},include:{course:{select:{instructorId:!0}}}});if(!i)return a.Z.json({error:"Topic not found"},{status:404});if(i.course.instructorId!==o.userId&&"ADMIN"!==o.role&&"SUPER_ADMIN"!==o.role)return a.Z.json({error:"Unauthorized"},{status:403});return await u._.topic.delete({where:{id:s}}),a.Z.json({message:"Topic deleted successfully"})}catch(r){return console.error("Error deleting topic:",r),a.Z.json({error:"Internal server error"},{status:500})}}let h=new s.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/courses/[id]/topics/route",pathname:"/api/courses/[id]/topics",filename:"route",bundlePath:"app/api/courses/[id]/topics/route"},resolvedPagePath:"E:\\BigDentist Website\\app\\api\\courses\\[id]\\topics\\route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:j,staticGenerationAsyncStorage:I,serverHooks:w,headerHooks:v,staticGenerationBailout:y}=h,Z="/api/courses/[id]/topics/route";function g(){return(0,n.patchFetch)({serverHooks:w,staticGenerationAsyncStorage:I})}},3205:(r,e,t)=>{t.d(e,{RA:()=>c,So:()=>l,WX:()=>d});var o=t(98432),s=t.n(o),i=t(46082),n=t.n(i),a=t(3214);let u=async(r,e)=>await s().compare(r,e),c=r=>n().sign(r,process.env.JWT_SECRET||"fallback-secret",{expiresIn:"7d"}),d=r=>{try{return n().verify(r,process.env.JWT_SECRET||"fallback-secret")}catch(r){return null}},l=async(r,e)=>{let t=await a._.user.findUnique({where:{email:r}});return t&&await u(e,t.password)?t:null}},3214:(r,e,t)=>{t.d(e,{_:()=>s});var o=t(53524);let s=globalThis.prisma??new o.PrismaClient}};var e=require("../../../../../webpack-runtime.js");e.C(r);var t=r=>e(e.s=r),o=e.X(0,[1638,6206,6082],()=>t(82292));module.exports=o})();