(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7460],{4462:function(e,s,t){Promise.resolve().then(t.bind(t,5140))},5140:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return y}});var a=t(7437),l=t(2265),r=t(9883),n=t(1827),c=t(6224),i=t(9676),o=t(1298),d=t(5750),x=t(8203),u=t(9617),m=t(1138),p=t(1396),h=t.n(p),g=t(4717);function b(e){let{value:s,onChange:t,placeholder:r="Search and select courses..."}=e,[n,c]=(0,l.useState)([]),[i,o]=(0,l.useState)(!1),[d,x]=(0,l.useState)(""),u=async e=>{o(!0);try{let s=await fetch("/api/courses/ids?search=".concat(encodeURIComponent(e)));if(s.ok){let e=await s.json();c(e)}}catch(e){console.error("Error fetching courses:",e)}finally{o(!1)}};(0,l.useEffect)(()=>{u("")},[]),(0,l.useEffect)(()=>{let e=setTimeout(()=>{u(d)},300);return()=>clearTimeout(e)},[d]);let m=s.map(e=>{let s=n.find(s=>s.id===e);return s?{value:s.id,label:s.title}:null}).filter(Boolean),p=n.map(e=>({value:e.id,label:e.title}));return(0,a.jsx)(g.ZP,{isMulti:!0,value:m,onChange:e=>{t(e?e.map(e=>e.value):[])},onInputChange:e=>{x(e)},options:p,placeholder:r,isLoading:i,isClearable:!0,isSearchable:!0,className:"w-full",classNamePrefix:"react-select",noOptionsMessage:()=>"No courses found",loadingMessage:()=>"Loading courses..."})}function y(){let[e,s]=(0,l.useState)([]),[t,p]=(0,l.useState)(!0),[g,y]=(0,l.useState)(""),[f,j]=(0,l.useState)(!1),[N,v]=(0,l.useState)({code:"",description:"",discountType:"PERCENTAGE",discountValue:"",minAmount:"",maxDiscount:"",usageLimit:"",validUntil:"",appliesToAllCourses:!0,allowedCourseIds:"",canStackWithOtherCoupons:!1}),[w,C]=(0,l.useState)([]),[k,A]=(0,l.useState)(!1),[S,E]=(0,l.useState)("");(0,l.useEffect)(()=>{T()},[]);let T=async()=>{try{let e=await fetch("/api/coupons");if(e.ok){let t=await e.json();s(t)}else console.error("Failed to fetch coupons")}catch(e){console.error("Error fetching coupons:",e)}finally{p(!1)}},D=async e=>{e.preventDefault(),A(!0),E("");try{let e={...N,allowedCourseIds:w.join(",")},s=await fetch("/api/coupons",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!s.ok){let e=await s.json();E(e.error||"Error creating coupon");return}v({code:"",description:"",discountType:"PERCENTAGE",discountValue:"",minAmount:"",maxDiscount:"",usageLimit:"",validUntil:"",appliesToAllCourses:!0,allowedCourseIds:"",canStackWithOtherCoupons:!1}),C([]),j(!1),T()}catch(e){E("Error creating coupon")}finally{A(!1)}},L=e=>{v({...N,[e.target.name]:e.target.value})},O=e=>{navigator.clipboard.writeText(e)},U=e.filter(e=>e.code.toLowerCase().includes(g.toLowerCase())||e.description&&e.description.toLowerCase().includes(g.toLowerCase()));return t?(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),(0,a.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading..."})]})}):(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,a.jsx)("div",{className:"bg-white shadow-sm border-b border-gray-200",children:(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)(h(),{href:"/admin",className:"text-gray-600 hover:text-gray-900",children:(0,a.jsx)("span",{className:"text-2xl",children:"\uD83C\uDFE0"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Coupon Management"}),(0,a.jsx)("p",{className:"text-gray-600 mt-2",children:"Create and manage discount coupons"})]})]}),(0,a.jsxs)("button",{onClick:()=>j(!0),className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors flex items-center gap-2",children:[(0,a.jsx)(r.Z,{className:"w-4 h-4"}),"Create Coupon"]})]})})}),(0,a.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,a.jsx)("div",{className:"bg-white rounded-lg shadow p-6 mb-8",children:(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(n.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),(0,a.jsx)("input",{type:"text",placeholder:"Search coupons...",value:g,onChange:e=>y(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})}),f&&(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow p-6 mb-8",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"Create New Coupon"}),(0,a.jsx)("button",{onClick:()=>j(!1),className:"text-gray-400 hover:text-gray-600",children:"âœ•"})]}),(0,a.jsxs)("form",{onSubmit:D,className:"space-y-6",children:[S&&(0,a.jsx)("div",{className:"bg-red-100 text-red-700 p-3 rounded",children:S}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Coupon Code *"}),(0,a.jsx)("input",{type:"text",name:"code",value:N.code,onChange:L,required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"e.g., SAVE20"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),(0,a.jsx)("input",{type:"text",name:"description",value:N.description,onChange:L,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"e.g., 20% off all courses"})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Discount Type *"}),(0,a.jsxs)("select",{name:"discountType",value:N.discountType,onChange:L,required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,a.jsx)("option",{value:"PERCENTAGE",children:"Percentage"}),(0,a.jsx)("option",{value:"FIXED_AMOUNT",children:"Fixed Amount"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Discount Value *"}),(0,a.jsx)("input",{type:"number",name:"discountValue",value:N.discountValue,onChange:L,required:!0,min:"0",step:"0.01",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"PERCENTAGE"===N.discountType?"20":"10.00"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Minimum Amount"}),(0,a.jsx)("input",{type:"number",name:"minAmount",value:N.minAmount,onChange:L,min:"0",step:"0.01",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"0.00"})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Max Discount (for %)"}),(0,a.jsx)("input",{type:"number",name:"maxDiscount",value:N.maxDiscount,onChange:L,min:"0",step:"0.01",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2ocus:ring-blue-500 focus:border-transparent",placeholder:"50.00"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Usage Limit"}),(0,a.jsx)("input",{type:"number",name:"usageLimit",value:N.usageLimit,onChange:L,min:"1",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2ocus:ring-blue-500 focus:border-transparent",placeholder:"100"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Valid Until"}),(0,a.jsx)("input",{type:"datetime-local",name:"validUntil",value:N.validUntil,onChange:L,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2ocus:ring-blue-500 focus:border-transparent"})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Course Applicability"}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("label",{className:"flex items-center",children:[(0,a.jsx)("input",{type:"radio",name:"appliesToAllCourses",value:"true",checked:!0===N.appliesToAllCourses,onChange:e=>v({...N,appliesToAllCourses:"true"===e.target.value}),className:"mr-2"}),(0,a.jsx)("span",{className:"text-sm text-gray-700",children:"Apply to all courses"})]}),(0,a.jsxs)("label",{className:"flex items-center",children:[(0,a.jsx)("input",{type:"radio",name:"appliesToAllCourses",value:"false",checked:!1===N.appliesToAllCourses,onChange:e=>v({...N,appliesToAllCourses:"true"===e.target.value}),className:"mr-2"}),(0,a.jsx)("span",{className:"text-sm text-gray-700",children:"Apply to specific courses only"})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Coupon Stacking"}),(0,a.jsx)("div",{className:"space-y-3",children:(0,a.jsxs)("label",{className:"flex items-center",children:[(0,a.jsx)("input",{type:"checkbox",name:"canStackWithOtherCoupons",checked:N.canStackWithOtherCoupons,onChange:e=>v({...N,canStackWithOtherCoupons:e.target.checked}),className:"mr-2"}),(0,a.jsx)("span",{className:"text-sm text-gray-700",children:"Can be combined with other coupons"})]})})]})]}),!N.appliesToAllCourses&&(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Courses"}),(0,a.jsx)(b,{value:w,onChange:C,placeholder:"Search and select courses..."}),(0,a.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"Select one or more courses that this coupon applies to."})]}),(0,a.jsxs)("div",{className:"flex justify-end space-x-4",children:[(0,a.jsx)("button",{type:"button",onClick:()=>j(!1),className:"px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancel"}),(0,a.jsx)("button",{type:"submit",disabled:k,className:"bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors flex items-center disabled:opacity-50",children:k?"Creating...":"Create Coupon"})]})]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:[(0,a.jsx)("div",{className:"px-6 py-4 border-b border-gray-200",children:(0,a.jsxs)("h2",{className:"text-lg font-semibold text-gray-900",children:["All Coupons (",U.length,")"]})}),0===U.length?(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)("div",{className:"text-6xl mb-4",children:"\uD83C\uDFAB"}),(0,a.jsx)("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"No coupons found"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Create your first coupon to start offering discounts"})]}):(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Code"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Description"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Discount"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Usage"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Applicability"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Stackable"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Valid Until"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:U.map(e=>(0,a.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("span",{className:"font-mono text-sm bg-gray-100 px-2 py-1 rounded",children:e.code}),(0,a.jsx)("button",{onClick:()=>O(e.code),className:"text-gray-400 hover:text-gray-600",title:"Copy code",children:(0,a.jsx)(c.Z,{className:"w-4 h-4"})})]})}),(0,a.jsx)("td",{className:"px-6 py-4",children:(0,a.jsx)("div",{className:"text-sm text-gray-900",children:e.description||"-"})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsxs)("div",{className:"flex items-center space-x-1",children:["PERCENTAGE"===e.discountType?(0,a.jsx)(i.Z,{className:"w-4 h-4 text-green-500"}):(0,a.jsx)(o.Z,{className:"w-4 h-4 text-green-500"}),(0,a.jsxs)("span",{className:"text-sm font-medium text-gray-900",children:[e.discountValue,"PERCENTAGE"===e.discountType?"%":""]})]})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,a.jsx)(d.Z,{className:"w-4 h-4 text-gray-400"}),(0,a.jsxs)("span",{className:"text-sm text-gray-900",children:[e.usedCount,e.usageLimit&&" / ".concat(e.usageLimit)]})]})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsx)("span",{className:"text-sm text-gray-900",children:e.appliesToAllCourses?"All Courses":"Specific (".concat(e.allowedCourseIds||"-",")")})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsx)("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full ".concat(e.canStackWithOtherCoupons?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800"),children:e.canStackWithOtherCoupons?"Yes":"No"})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsx)("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full ".concat(e.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:e.isActive?"Active":"Inactive"})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,a.jsx)(x.Z,{className:"w-4 h-4 text-gray-400"}),(0,a.jsx)("span",{className:"text-sm text-gray-900",children:e.validUntil?new Date(e.validUntil).toLocaleDateString():"No expiry"})]})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("button",{className:"text-blue-600 hover:text-blue-900",children:(0,a.jsx)(u.Z,{className:"w-4 h-4"})}),(0,a.jsx)("button",{className:"text-red-600 hover:text-red-900",children:(0,a.jsx)(m.Z,{className:"w-4 h-4"})})]})})]},e.id))})]})})]})]})]})}}},function(e){e.O(0,[5250,4964,2971,4938,1744],function(){return e(e.s=4462)}),_N_E=e.O()}]);